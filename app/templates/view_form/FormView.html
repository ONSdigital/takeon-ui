{% extends "base.html" %}

{% block title %}Contributor Details{% endblock title %}


{% block page_header %}

    <h1 class="jupiter main_heading">Take-On</h1>

{% endblock page_header %}

<br>
{% block content %}

    <h1>{{ contributor_details['referencename'] }}</h1>
    <p>
        <strong>Reference:</strong> <span id="ref">{{ contributor_details['reference'] }}</span>
        <strong>Period:</strong> <span id="period">{{ contributor_details['period'] }}</span>
        <strong>Survey:</strong> <span id="survey">{{ contributor_details['survey'] }}</span>
        <strong>Status:</strong> {{ contributor_details['status'] }}
    </p>
    
    <br>

    <div class="mainContent">
        <!-- <div class="grid">
            <div class="grid__col col-6@m paddingSection"> -->
                <form method="post" id="responseForm">
                    
                    {% for datum in data['form_validation_outputs'] %}
                    
                        {% if datum['validation_info']|length > 0 %}

                        <div class="panel {{ datum['panel'] }} panel--simple">
                            <div class="panel__body">
                                <strong>{{ datum["displayquestionnumber"] }}</strong> <strong> {{ datum["displaytext"] }}</strong>
                                <br>
                                <input name="{{ datum['questioncode'] }}" value="{{ datum['response'] }}" type="number" class="input input--text input-type__input">
                                <br>
                                <fieldset class="fieldset">
                                    <legend class="fieldset__legend">Select Validation To Override</legend>
                                    <!-- <div class="panel panel--error panel--simple">
                                    <div class="panel__body"> -->
                                    <span class="checkboxes__items">
                                        {% for output in datum['validation_info'] %}
                                            {% if output['overridden'] == True %}

                                            <p class="checkboxes__item">
                                                <span class="checkbox ">
                                                    <input type="checkbox" id="{{output['validationoutputid']}}" class="checkbox__input js-checkbox " value="{{output['validationoutputid']}}" name="override-checkbox" checked>
                                                    <p class="field">
                                                    <label id="{{output['validationoutputid']}}-label" class="checkbox__label " for="{{output['validationoutputid']}}"> <strong>{{ output["name"] }}</strong></br>
                                                    </label>
                                                    </p>
                                                </span>
                                            </p>
                                            {% else %}
                                            <p class="checkboxes__item">
                                                <span class="checkbox ">
                                                    <p class="field">
                                                    <input type="checkbox" id="{{output['validationoutputid']}}" class="checkbox__input js-checkbox " value="{{output['validationoutputid']}}" name="override-checkbox">
                                                    <label id="{{output['validationoutputid']}}-label" class="checkbox__label " for="{{output['validationoutputid']}}"> <strong>{{ output["name"] }}</strong></br>
                                                    </label>
                                                    </p>
                                                </span>
                                            </p>
                                            {% endif %}
                                        {% endfor %}
                                            </span>  
                                        </fieldset>
                                    </div>
                                </div>

                            {% else %}

                            <strong>{{ datum["displayquestionnumber"] }}</strong> <strong> {{ datum["displaytext"] }}</strong>
                            <br>
                            <input name="{{ datum['questioncode'] }}" value="{{ datum['response'] }}" type="number" class="input input--text input-type__input">

                            {% endif %}
                                <br>
                                <br>
                    {% endfor %}

                <!-- </form> -->
                <span class="checkbox ">
                    <input type="checkbox" id="select-all" class="checkbox__input js-checkbox " value="Select All" name="select-all-checkbox" onclick="select_all(this)">
                    <label id="select_all" class="checkbox__label" for="select-all">
                        <strong>Select All</strong>
                    </label>
                </span>
                <br>
                <br>
            <!-- </div> -->
            <!-- </div> -->
    </div>


    <div class="mainContent">
    <!-- <form method="POST" action=""> -->

        <button class="btn btn--small" type="submit" id="saveFormButton" value="saveForm" name="action">
            <span class="btn__inner">Save</span>
        </button>
        <!-- <form method="POST" action=""> -->
        <button class="btn btn--small" type="submit" class="btn btn-group__btn btn--loader js-loader js-submit-btn" value='validate' name='action'>
            <span class="btn__inner">Validate</span>
        </button>
        <!-- </form> -->
        <button class="btn btn--small" type="submit" class="btn btn-group__btn btn--loader js-loader js-submit-btn" value='override' name='action' id='override_button'>
            <span class="btn__inner">Override</span>
        </button>

        <button class="btn btn--small" type="submit" value="close this window" onclick="self.close()">
            <span class="btn__inner">Exit</span>
        </button>
    </form>
    </div>

    <br>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
        var override_button = document.getElementById("override_button")
        override_button.addEventListener("click", function()
        {var checkboxes = document.getElementsByName("override-checkbox");
           var reference  = document.getElementById("ref").textContent;
           var period     = document.getElementById("period").textContent;
           var survey     = document.getElementById("survey").textContent;
           var user       = '{{ user }}';
           var checkboxes_checked = []
           var checkboxes_output  = {}
           for(var i = 0; i < checkboxes.length; i++) {
                if(checkboxes[i].checked) {
                    var checkbox = {}
                    checkbox["validationoutputid"] = checkboxes[i].id
                    checkbox["override"]           = true
                    checkbox["user"]               = user
                    checkboxes_checked.push(checkbox)
                } else {
                    var checkbox = {}
                    checkbox["validationoutputid"] = checkboxes[i].id
                    checkbox["override"]           = false
                    checkbox["user"]               = user
                    checkboxes_checked.push(checkbox)
                }
           }
            checkboxes_output['reference']          = reference
            checkboxes_output['period']             = period
            checkboxes_output['survey']             = survey
            checkboxes_output['validation_outputs'] = checkboxes_checked
            var js_data = JSON.stringify(checkboxes_output)
            $.ajax({
               url: 'override-validations',
               type: 'post',
               contentType: 'application/json',
               dataType: 'json',
               data: js_data,
               async: false
           })
           window.location.reload()})
    </script>

    <script>
        function select_all(source) {
            checkboxes = document.getElementsByName("override-checkbox");
            for(var i=0; i < checkboxes.length; i++){
                checkboxes[i].checked = source.checked;
            }
        }
    </script>

    <script>
        var statusMessage = "{{ status_message }}"
        console.log(statusMessage)
        if (statusMessage == "&#34;&#34;") {
        } else {
            alert(statusMessage);
        }
    </script>

{% endblock content %}