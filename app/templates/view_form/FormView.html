{% extends "base.html" %}

{% block title %}Contributor Details{% endblock title %}


{% block page_header %}

    <h1 class="jupiter main_heading">Take-On</h1>

{% endblock page_header %}

<br>
{% block content %}

    <!--
    <div id="lockedInfo" style="display:none">
        <div class="panel panel--error panel--simple">
            <div class="panel__error">
                <div class="u-fs-r--b">Form locked</div>
            </div>
            <div class="panel__body">
                <div>This form is currently checked out by {{ locked }}. Editing will be disabled until it has been
                    checked
                    back in.
                </div>
            </div>
        </div>
    </div>
    -->

    <div class="panel panel--info panel--simple">
        <div class="panel__body">

            <h1>{{ contributor_details['referencename'] }}</h1>
            <p><b>Reference:</b> {{ contributor_details['reference'] }}
                <b>Period:</b> {{ contributor_details['period'] }}
                <b>Survey:</b> {{ contributor_details['survey'] }}
                <b>Status:</b> {{ contributor_details['status'] }} </p>
        </div>
    </div>
    <br>


    <div class="mainContent">
        <form method="post" id="save" action="">
                <button class="btn btn--small" type="submit" id="editFormButton" value="saveForm" name="action"
                        onclick="submitForm()">
                    <span class="btn__inner">Edit</span></button>
            </form>
            <br>

            <div class="grid">
                <div class="grid__col col-6@m paddingSection">
                    {% for datum in data['view_form_responses'] %}
                        <div>
                            <p class="field">
                                <label class="label">{{ datum["displayquestionnumber"] }}
                                    <strong>{{ datum["displaytext"] }}</strong>
                                    <br>
                                    <span class="label__description" style="color:red">{{ datum["questioncode"] }}</span>
                                </label>
                                <input name="response:{{ datum['questioncode'] }}"
                                        value="{{datum['response']}}"
                                        id="questioncode:{{ datum['questioncode'] }}|instance:{{ datum['instance'] }}"
                                        class="input input--text input-type__input" readonly>
                            </p>
                            <br>
                            <br>
                        </div> 
                    {% endfor %}
                </div>

                <div class="grid__col col-6@m paddingSection">
                    <div id="accordion" class="accordion">
                        <div class="wrapper">
                            <div class="response-split">
                                <fieldset class="fieldset">
                                    <legend class="fieldset__legend">What Validations would you like to override?
                                    </legend>
                                    <p class="checkboxes__label">Select all that apply</p>
                                    <span class="checkboxes__items">
                                    {% for output in validation['validation_outputs'] %}
                                                  <p class="checkboxes__item">
                                      <span class="checkbox ">
                                          <input
                                              type="checkbox"
                                              id="bacon-{{loop.index}}"
                                              class="checkbox__input js-checkbox "
                                              value="bacon-{{loop.index}}"
                                              name="test"
                                          >
                                          <label id="{{loop.index}}-label" class="checkbox__label " for="bacon-{{loop.index}}">
                                            <strong>{{ output["primaryquestion"] }}</strong></br>
                                            <strong>{{ output["name"] }}</strong></br>
                                            <b>Validation ID: {{ output["validationid"] }}</b></br>
                                            <b>Formula: {{ output["formula"] }}</b></br>
                                            <b>Triggered: {{ output["triggered"] }}</b></br>
                                          </label>
                                      </span>
                                    </p>
                                    <br>
                                    {% endfor %}
                                    </span>
                                  </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <div class="mainContent">
    <form method="POST" action="">
        <button class="btn btn--small" type="submit" value="close this window" onclick="self.close()">
            <span class="btn__inner">Exit</span>
            <br>
        </button>

        <button class="btn btn--small" type="submit" class="btn btn-group__btn btn--loader js-loader js-submit-btn" value='validate' name='action'>
            <span class="btn__inner">Validate</span>
            <br>
        </button>

        <button class="btn btn--small" type="submit" class="btn btn-group__btn btn--loader js-loader js-submit-btn" value='override' name='action'>
            <span class="btn__inner">Override</span>
            <br>
        </button>

    </form>
    </div>


    <script>
        function openTab(evt, details) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(details).style.display = "block";
            evt.currentTarget.className += " active";
        }

        document.getElementById("defaultOpen").click();
    </script>

    <!--
    <script>
        var isLockedBy = "{{ locked }}"
        if (isLockedBy != "") {
            document.getElementById("editFormButton").disabled = true;
            document.getElementById("editFormButton").style.color = "grey";
            var bar = document.getElementById("lockedInfo");
            bar.style.display = "block";
        }  
        document.getElementById("SectionA").style.display = "block"
    </script>
    -->

    <script>
        var acc = document.getElementsByClassName("accordion-legacy");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                /* Toggle between adding and removing the "active" class,
                to highlight the button that controls the panel */
                this.classList.toggle("active");

                /* Toggle between hiding and showing the active panel */
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }
    </script>

    <script>
        var regex = new RegExp('(.+\|.+_)');
        var inputElements = document.getElementsByTagName('input');
        var index;
        var responseElements = inputElements.filter(element => document.querySelector('[id^="questionCode"]'));
        window.alert(responseElements);
    </script>


    <br>
    <br>
    <br>
    <br>

{% endblock content %}